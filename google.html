
<!DOCTYPE html>
<html>

<head>
    <title>Place searches</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <style>
        /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */

        #map {
            height: 400px;
            width: 100%;
        }

        /* Optional: Makes the sample page fill the window. */

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div>
        <button id="cafes">Cafes</button>
        <button id="bar">Bars</button>
        <button id="restaurant">Restaurant</button>
        <button id="art_gallery">Art Galleries</button>
        <button id="movie_theater">Movie Theater</button>
        <button id="spa">Spa</button>
    </div>
    <div id="place-list"></div>
    <div id="placesInfo"></div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD3Cv_7tEcDnrolF56mQG__51eGn9DIa3g&libraries=places&callback=initMap" async defer>
        </script>
        <script>

            var map;
            var marker;
        
            // use the different category buttons to reload the map based on location types
            $("#cafes").on('click', function() {
                initMap('cafe');
            });
            $("#bar").on('click', function () {
                    initMap('bar');
                });
            $("#art_gallery").on('click', function () {
                    initMap('art_gallery');
                });
            $("#restaurant").on('click', function () {
                    initMap('restaurant');
                });
            $("#movie_theater").on('click', function () {
                    initMap('movie_theater');
                });
            $("#spa").on('click', function () {
                    initMap('spa');
                });

            function initMap(category) {
                $(".placeInfo").remove();
                $("#place-list").text("");
                //let placeInfoBox = "";
                // Create the map.
                var durham = { lat: 35.997, lng: -78.904 };
                map = new google.maps.Map(document.getElementById('map'), {
                    center: durham,
                    zoom: 15
                });

                // Create the places service.
                var service = new google.maps.places.PlacesService(map);
                var getNextPage = null;
                var moreButton = document.getElementById('more');
                // Perform a nearby search.
                service.nearbySearch(
                    { location: durham, radius: 1400, type: [category] },
                    function (results, status, pagination) {
                        if (status !== 'OK') return;

                        createMarkers(results);
                    });



            }

            function createMarkers(places) {
                var bounds = new google.maps.LatLngBounds();
                var placesList = document.getElementById('places');

                for (var i = 0, place; place = places[i]; i++) {
                    var image = {
                        url: place.icon,
                        size: new google.maps.Size(71, 71),
                        origin: new google.maps.Point(0, 0),
                        anchor: new google.maps.Point(17, 34),
                        scaledSize: new google.maps.Size(25, 25)
                    };

                    var marker = new google.maps.Marker({
                        map: map,
                        icon: image,
                        title: place.name,
                        position: place.geometry.location
                    });
                    /*
                    var div = document.createElement('div');
                    $(div).addClass('placeInfo');
                    var li = document.createElement('li');
                    li.textContent = place.name;
                    div.appendChild(li);
                    placesList.appendChild(div);
                    
                    */
                     bounds.extend(place.geometry.location);
                    logPlaceDetails(place.place_id);
                    function logPlaceDetails(location) {
                        var service = new google.maps.places.PlacesService($('#placesInfo').get(0));
                        service.getDetails({
                            placeId: location
                        }, function (place, status) {
                            console.log('Place details:', place);
                            createInfoBox(place);
                        });
                    }

                    function createInfoBox(place) {
                        //var photos = place.photos;
                        let placeInfoBox = 
                        `<div class="panel panel-default">
                            <div class="panel-heading">
                                <h2>${place.name}</h2>
                                <h3>${place.formatted_address}</h3>
                                <p>${place.formatted_phone_number}</p>
                            </div>
                        </div>`;

                        $("#place-list").append(placeInfoBox);

                       
                    }
                }
                map.fitBounds(bounds);


            }
        </script>
</body>

</html>