<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Directions service</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <style>
        /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */

        #map {
            height: 550px;
            width: 70%;
            float: left;
        }

        #directionsPanel {
            float: right;
            width: 30%;
        }
        .card {
            margin: 45px;
            float: left;
        }
        img.progress {
            height: auto;
        }

        /* Optional: Makes the sample page fill the window. */

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div id="directionsPanel"></div>
    <div id="placesInfo"></div>
    <div id="place-list" class="container py-3">
    
    </div>
    <script>
        function initMapEvent() {
            var directionsService = new google.maps.DirectionsService;
            var directionsDisplay = new google.maps.DirectionsRenderer;
            let durham = { lat: 35.997, lng: -78.904 };
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 15,
                center: durham
            });
            directionsDisplay.setMap(map);
            // we can toggle this on a button for users to hide/unhide if they want to see directions
            directionsDisplay.setPanel(document.getElementById('directionsPanel'));

            calculateAndDisplayRoute(directionsService, directionsDisplay);
        }

        function calculateAndDisplayRoute(directionsService, directionsDisplay) {
            directionsService.route({
                origin: "ChIJce4F62zkrIkRZJd_w2se5z4",
                destination: "ChIJv-CR4MvlrIkR0fP0Hr0ERUo",
                waypoints: [{
                    location: "ChIJh3eRD27krIkRpG-tTJnXAf8",
                    stopover: true
                }],
                travelMode: 'WALKING'
            }, function (response, status) {
                if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                    logPlaceDetails(response.geocoded_waypoints[0].place_id);
                    logPlaceDetails(response.geocoded_waypoints[1].place_id);
                    logPlaceDetails(response.geocoded_waypoints[2].place_id);
                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        }

        function logPlaceDetails(location) {
                var service = new google.maps.places.PlacesService($('#placesInfo').get(0));
                service.getDetails({
                    placeId: location
                }, function (place, status) {
                    console.log('Place details:', place);
                    createInfoBox(place);
                });
            }

        function createInfoBox(place) {
                let photos = place.photos[0].getUrl({ 'maxWidth': 270, 'maxHeight': 350 });
            let placeInfoBox =
                ` 
                    <div class="card">
                        <div class="row">
                            <div class="col-md-4 container-fluid">
                                <img src="${photos}" class="w-100 img-responsive progress">
                            </div>
                            <div class="col-md-8 px-3">
                                <div class="card-block px-3">
                                    <br>
                                    <h2 class="card-title">${place.name}<span><a href="${place.website}" target="_blank" class="btn btn-sm btn-primary card-btn">More Info</a></span></h2>
                                    <p class="card-text"><em>Google rating: ${place.rating}</em></p>
                                    <h5 class="card-text">${place.formatted_address}</h5>
                                    <h5 class="card-text">${place.formatted_phone_number}</h5>
                                    <br>
                                </div>
                            </div>
                        </div>
                    </div>    
                        `;
                        $("#place-list").append(placeInfoBox);
            }
    </script>
    
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD3Cv_7tEcDnrolF56mQG__51eGn9DIa3g&libraries=places&callback=initMapEvent"></script>
    
</body>

</html>